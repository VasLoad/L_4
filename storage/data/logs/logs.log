2025-12-15 02:01:22,973 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await search_album_handler(callback.message, album_id=callback_data.track_id)
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 165, in search_album_handler
    albums: list[SpotifyAlbum] = spotify_client.search_album(message.text, limit=1)
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 217, in search_album
    return self.search(name, type=ContentType.ALBUM, limit=limit)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 237, in search
    items = response.json()["tracks"]["items"]
            ~~~~~~~~~~~~~~~^^^^^^^^^^
KeyError: 'tracks'
2025-12-15 02:02:58,791 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:04:34,727 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:05:51,888 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:12:31,665 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 02:39:42,909 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:53:41,090 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 03:10:19,422 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 118, in search_track_handler
    tracks: list[SpotifyTrack] = spotify_client.search_track(message.text, limit=1)
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 211, in search_track
    return self.search(name, type=ContentType.TRACK, limit=limit)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 237, in search
    items = response.json()["tracks"]["items"]
            ~~~~~~~~~~~~~~~^^^^^^^^^^
KeyError: 'tracks'
2025-12-15 03:10:28,763 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 03:10:29,768 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 03:11:01,622 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\venv_2\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 03:11:06,903 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:40:42,706 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-15 16:40:56,610 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:41:02,475 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:41:09,093 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-15 16:41:38,011 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:41:41,001 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-12-15 16:41:44,977 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-12-15 16:43:04,780 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:43:10,247 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 118, in search_track_handler
    tracks: list[SpotifyTrack] = spotify_client.search_track(message.text, limit=1)
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 211, in search_track
    return self.search(name, type=ContentType.TRACK, limit=limit)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 237, in search
    items = response.json()["tracks"]["items"]
            ~~~~~~~~~~~~~~~^^^^^^^^^^
KeyError: 'tracks'
2025-12-15 16:43:18,441 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:43:19,452 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:43:25,933 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:43:37,084 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-12-15 16:44:35,645 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 16:46:26,066 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:47:04,805 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 16:47:20,309 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:47:41,648 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 16:48:35,733 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:49:00,784 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 16:49:24,553 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:50:45,251 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:50:50,752 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:51:07,803 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 212, in spotify_track_handler
    await process_spotify_track(
    ...<3 lines>...
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 77, in process_spotify_track
    track: DownloadedTrackFile = download_track_spotify(
                                 ~~~~~~~~~~~~~~~~~~~~~~^
        spotify_url,
        ^^^^^^^^^^^^
        str(download_dir)
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\utils\download.py", line 61, in download_track_spotify
    print(mp3_files)
    
IndexError: list index out of range
2025-12-15 16:55:33,576 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 16:56:32,269 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 16:56:33,961 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 17:05:02,607 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 17:05:32,592 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 235, in spotify_track_handler
    await callback.answer()
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
        bot=bot,
    ...<2 lines>...
        content=raw_result,
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-12-15 17:38:12,139 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 17:38:15,889 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 260, in search_track_handler
    text = ContentMessageTextTrack(track).text
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 110, in text
    text = self._container(
        name=self.__track.name,
    ...<2 lines>...
        data=data
    )
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 68, in _container
    text += "\n" + self.__border
                   ^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 91, in __border
    return self.__container_border_symbol * self.__container_border_len
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~
TypeError: can't multiply sequence by non-int of type 'NoneType'
2025-12-15 17:38:37,103 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
