2025-12-15 02:01:22,973 - handlers.user - ERROR - Ошибка в обработчике:
Traceback (most recent call last):
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 218, in spotify_track_handler
    await search_album_handler(callback.message, album_id=callback_data.track_id)
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\handlers\user.py", line 165, in search_album_handler
    albums: list[SpotifyAlbum] = spotify_client.search_album(message.text, limit=1)
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 217, in search_album
    return self.search(name, type=ContentType.ALBUM, limit=limit)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\PyCharm\Projects\Learn\AP\L_4\services\spotify.py", line 237, in search
    items = response.json()["tracks"]["items"]
            ~~~~~~~~~~~~~~~^^^^^^^^^^
KeyError: 'tracks'
2025-12-15 02:02:58,791 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:04:34,727 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-15 02:05:51,888 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
